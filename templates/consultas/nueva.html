{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    {% if editar %}
                    <i class="bi bi-pencil"></i> Editar Consulta - {{ paciente.nombre_completo }}
                    {% else %}
                    <i class="bi bi-calendar-plus"></i> Nueva Consulta - {{ paciente.nombre_completo }}
                    {% endif %}
                </h4>
            </div>
            <div class="card-body">
                <form method="POST">
                    <h5 class="text-success">Datos de la Consulta</h5>
                    <hr>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="fechaConsulta" class="form-label">Fecha de Consulta</label>
                            <input type="date" class="form-control" id="fechaConsulta" name="fechaConsulta" 
                                   value="{{ consulta.fechaConsulta if consulta else '' }}" required>
                        </div>
                        <div class="col-md-3">
                            <label for="horaE" class="form-label">Hora Entrada</label>
                            <input type="time" class="form-control" id="horaE" name="horaE" 
                                   value="{{ consulta.horaE if consulta else '' }}" required>
                        </div>
                        <div class="col-md-3">
                            <label for="horaS" class="form-label">Hora Salida</label>
                            <input type="time" class="form-control" id="horaS" name="horaS" 
                                   value="{{ consulta.horaS if consulta else '' }}" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="descripcion" class="form-label">Descripción de la Consulta</label>
                        <textarea class="form-control" id="descripcion" name="descripcion" rows="2">{{ consulta.descripcion if consulta else '' }}</textarea>
                    </div>
                    
                    <h5 class="text-success mt-4">Diagnóstico</h5>
                    <hr>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="peso" class="form-label">Peso (kg)</label>
                            <input type="number" step="0.01" class="form-control" id="peso" name="peso" 
                                   value="{{ consulta.diagnostico.peso if consulta and consulta.diagnostico else '' }}" required>
                        </div>
                        <div class="col-md-6">
                            <label for="estatura" class="form-label">Estatura (m)</label>
                            <input type="number" step="0.01" class="form-control" id="estatura" name="estatura" 
                                   value="{{ consulta.diagnostico.estatura if consulta and consulta.diagnostico else '' }}" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="diagnostico_desc" class="form-label">Descripción del Diagnóstico</label>
                        <textarea class="form-control" id="diagnostico_desc" name="diagnostico_desc" rows="3">{{ consulta.diagnostico.descripcion if consulta and consulta.diagnostico else '' }}</textarea>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('pacientes.detalle', id=paciente.idPaciente) }}" class="btn btn-secondary">Cancelar</a>
                        <button type="submit" class="btn btn-success">
                            {% if editar %}
                            <i class="bi bi-check-circle"></i> Actualizar
                            {% else %}
                            <i class="bi bi-save"></i> Guardar Consulta
                            {% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('peso').addEventListener('change', calcularIMC);
document.getElementById('estatura').addEventListener('change', calcularIMC);

function calcularIMC() {
    let peso = document.getElementById('peso').value;
    let estatura = document.getElementById('estatura').value;
    
    if (peso && estatura && estatura > 0) {
        let imc = (peso / (estatura * estatura)).toFixed(2);
        // Mostrar IMC en algún lugar si se desea
    }
}
</script>
{% endblock %}